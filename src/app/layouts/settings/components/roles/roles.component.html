<!-- Card con roles -->

<div class="box-title">
    <p class="title">Listado de roles</p>
    <p class="subtitle">Los roles permiten definir el acceso o restricción de los usuarios a diferentes secciones de la aplicación.</p>
</div>

<div class="row g-4">
    <div class="col-xl-4 col-lg-6 col-md-6" *ngFor="let card of card_users">
        <mat-card class="mat-card m-0">
            <mat-card-header>
              <div style="display: flex; justify-content:space-between; align-items: center; margin-bottom: 0.5rem; width: 100%;">
                <h6 class="mb-0" style="color: rgba(0, 0, 0, 0.54); font-weight: 500;">Total {{ card['user'].length }} usuarios</h6>
                <ul style="padding-left: 0; list-style: none; display: flex; align-items: center; margin-bottom: 0;">
                    <ng-container *ngFor="let user of card.user, let i = index">
                        <li *ngIf="i < 3" [ngStyle]="{'margin-left':(i == 0?'0':'-0.65rem') }" [style.z-index]="card['user'].length - i">
                            <button
                                mat-icon-button
                                matTooltip={{user.name_employee}}
                                matTooltipPosition=above
                                class="btn-header-login p-1"
                                style="background-color: #fff;"
                            > <img style="width: 100%; height: 100%; border-radius: 50%;" [src]="source + user.thumbnail" alt="avatar" class="profile-pic-icon">
                            </button>
                        </li>
                    </ng-container>
                        <li style="position: relative; margin-left: -0.65rem; z-index: 0;" *ngIf="card['user'].length > 3">
                            <button
                                mat-icon-button
                                matTooltip="+ {{ card['user'].length - 3 }}"
                                matTooltipPosition=above
                                class="btn-header-login p-1"
                                style="background-color: #fff;"
                            > <p style="margin-bottom: 0!important; color: rgba(0, 0, 0, 0.54); font-size: 0.95rem; font-weight: 500;">+ {{ card['user'].length - 3 }}</p>
                            </button>
                        </li>
                </ul>
              </div>
            </mat-card-header>
            <mat-card-content style="display: flex; justify-content: space-between; align-items: center;">
                <h3 class="mb-0" style="text-transform: capitalize;">{{ card.role }}</h3>
                <button mat-button color="primary">Editar</button>
            </mat-card-content>
          </mat-card>
    </div>
    <!-- Card para crear roles -->
    <div class="col-xl-4 col-lg-6 col-md-6">
        <mat-card class="mat-card m-0" style="height: 100%;">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px; height: 100%;">
                <div><img src="" alt=""></div>
                <div style="display: flex; flex-direction: column; justify-content: space-between; align-items: flex-end;">
                    <button mat-raised-button color="primary">Crear Rol</button>
                    <h5 class="mb-0 mt-2" style="color: rgba(0, 0, 0, 0.54); font-weight: 500;">Crea un rol si no existe</h5>
                </div>
            </div>
        </mat-card>
    </div>
</div>


<!-- Listadod de usuarios y sus roles -->

<div class="box-title mt-5">
    <p class="title">Listado de usuarios</p>
    <p class="subtitle mb-1">Los roles permiten definir el acceso o restricción de los usuarios a diferentes secciones de la aplicación.</p>
</div>

<div>
    <div class="box-table" *ngIf="!recharge">
        <mat-form-field  class="bill-filter-input">
            <mat-label>Filtrar</mat-label>
            <input matInput (keyup)="applyFilter($event)" placeholder="Ex. texto" #input>
        </mat-form-field>
        <table mat-table [dataSource]="dataSource">
          
            <!-- Name Column -->
            <ng-container matColumnDef="user">
              <th mat-header-cell *matHeaderCellDef> Usuario </th>
              <td mat-cell *matCellDef="let element">
                <div style="display: flex; justify-content: left; align-items: center;">
                    <div style="margin-right: 0.5rem;">
                        <div style="position: relative; width: 2.5rem; height: 2.5rem; cursor: pointer;">
                            <img style="width: 100%; height: 100%; border-radius: 50%;" [src]="source + element.thumbnail" [alt]="element.email">
                        </div>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <h5 style="text-transform: capitalize; margin-bottom: 0;">{{ (element.name_employee)?element.name_employee:element.email.split("@")[0] }}</h5>
                    </div>
                </div>
              </td>
            </ng-container>
          
            <!-- Email Column -->
            <ng-container *ngIf="is_large" matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef> Email </th>
              <td mat-cell *matCellDef="let element">
                <h5 class="text-muted" style="margin-bottom: 0;">{{element.email}} </h5>
              </td>
            </ng-container>
          
            <!-- Role Column -->
            <ng-container matColumnDef="role">
              <th mat-header-cell *matHeaderCellDef> Rol </th>
              <td mat-cell *matCellDef="let element">
                <div style="display: flex; justify-content: left; align-items: center;">
                    <mat-icon color="primary" [matTooltip]=element.role matTooltipPosition=above>{{ element.icon_role }}</mat-icon>
                    <h5 *ngIf="is_large" style="margin-bottom: 0; text-transform: capitalize; margin-left: 0.5rem;">{{ element.role }}</h5>
                </div>
              </td>
            </ng-container>

            <!-- Verified email Column -->
            <ng-container matColumnDef="verified">
                <th mat-header-cell *matHeaderCellDef> Verificado </th>
                <td mat-cell *matCellDef="let element">
                    <mat-chip class="cap" 
                            [style]="{'background-color':element.verified_state == 1?'rgb(230, 247, 217)':'rgb(255, 196, 189)'}"
                            >
                            <span *ngIf="is_large" [style]="{'color':element.verified_state == 1?'rgb(86, 202, 0)':'rgb(255, 87, 51)'}">{{ (element.verified_state)?'Verificado':'No verificado' }}</span>
                            <mat-icon *ngIf="!is_large">{{ element.verified_state == 1?'check':'close' }}</mat-icon>
                    </mat-chip>
                </td>
              </ng-container>
          
            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef> Estado </th>
              <td mat-cell *matCellDef="let element">
                    <mat-chip class="cap" 
                          [style]="{'background-color':element.state_employee == 1?'rgb(230, 247, 217)':'rgb(237, 238, 239)'}">
                          <span *ngIf="is_large" [style]="{'color':element.state_employee == 1?'rgb(86, 202, 0)':'rgb(138, 141, 147)'}">{{ (element.state_employee)?'Activo':'Inactivo' }}</span>
                          <mat-icon *ngIf="!is_large">{{ element.state_employee == 1?'check_circle_outline':'remove_circle_outline' }}</mat-icon>
                    </mat-chip>
              </td>
            </ng-container>

            <!-- Detail Column -->
            <ng-container matColumnDef="view">
                <th mat-header-cell *matHeaderCellDef> Detalles </th>
                <td mat-cell *matCellDef="let element">
                    <a href="#" mat-icon-button color="primary" aria-label="">
                        <mat-icon>
                            <span style="height: 5px; width: 5px; background-color: red; border-radius: 50%; position: absolute;">1</span>
                            visibility
                        </mat-icon>
                    </a>
                </td>
              </ng-container>
          
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="bill-row"></tr>

            <!-- Row shown when there is no matching data. -->
            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="4">Búsqueda sin resultados para "{{input.value}}"</td>
            </tr>
        </table>
        <mat-paginator class="m-t-15" [length]="resultsLength" [pageSize]="10" showFirstLastButtons aria-label="paginador"></mat-paginator>              
    </div>
    <div class="billing-recharge" *ngIf="recharge">
        <!-- Botón para recargar los datos -->
        <button mat-raised-button (click)="rechargeData()">Recargar los datos</button>
    </div>
</div>